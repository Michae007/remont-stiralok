name: Scrape Avito Reviews

on:
  schedule:
    # –ó–∞–ø—É—Å–∫–∞–µ–º –∫–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 9:00 —É—Ç—Ä–∞
    - cron: '0 9 * * 1'
  workflow_dispatch:  # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é

jobs:
  scrape-reviews:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
    
    steps:
    - name: üì• –°–∫–∞—á–∏–≤–∞–µ–º –∫–æ–¥
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: üêç –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º —Å–±–æ—Ä –æ—Ç–∑—ã–≤–æ–≤
      run: |
        python scraper.py
        
    - name: üìä –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
      run: |
        echo "=== –†–ï–ó–£–õ–¨–¢–ê–¢ –†–ê–ë–û–¢–´ ==="
        ls -la reviews.json
        echo "–ü–µ—Ä–≤—ã–µ 500 —Å–∏–º–≤–æ–ª–æ–≤ —Ñ–∞–π–ª–∞:"
        head -c 500 reviews.json
        echo ""
        
    - name: üíæ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Git
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        
    - name: üìù –ö–æ–º–º–∏—Ç–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
      run: |
        git add reviews.json
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
        if git diff --staged --quiet; then
          echo "üîÑ –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
        else
          git commit -m "ü§ñ –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–æ–≤ [$(date +%Y-%m-%d)]"
          echo "‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã"
        fi
        
    - name: üöÄ –ü—É—à–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
      run: |
        # –ü—Ä–æ–±—É–µ–º —Å–¥–µ–ª–∞—Ç—å push —Å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –ø–µ—Ä–µ–∑–∞–ø–∏—Å–æ–π –∏—Å—Ç–æ—Ä–∏–∏ (–∞–∫–∫—É—Ä–∞—Ç–Ω–æ)
        git pull --rebase origin main
        git push origin main
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
