name: Scrape Avito Reviews

on:
  schedule:
    # –ó–∞–ø—É—Å–∫–∞–µ–º –∫–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 9:00 UTC (12:00 –ø–æ –ú–æ—Å–∫–≤–µ)
    - cron: '0 9 * * 1'
  workflow_dispatch:  # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é
  push:
    branches: [ main ]

jobs:
  scrape-reviews:
    runs-on: ubuntu-latest
    
    steps:
    - name: üì• –°–∫–∞—á–∏–≤–∞–µ–º –∫–æ–¥
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: üêç –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –ø–∞—Ä—Å–µ—Ä –æ—Ç–∑—ã–≤–æ–≤
      run: |
        python scraper.py
        
    - name: üìä –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
      run: |
        echo "=== –†–ï–ó–£–õ–¨–¢–ê–¢ –†–ê–ë–û–¢–´ –ü–ê–†–°–ï–†–ê ==="
        cat reviews.json
        echo "================================="
        
    - name: üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add reviews.json
        git diff --quiet && git diff --staged --quiet || (git commit -m "ü§ñ –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–æ–≤ [$(date +%Y-%m-%d)]" && git push)
